<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finity - Expense Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #1d3557;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --body-bg: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            --sidebar-bg: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
        }

        .dark-mode {
            --primary: #5e72e4;
            --secondary: #4a56d0;
            --success: #2dce89;
            --danger: #f5365c;
            --warning: #fba540;
            --dark: #e2e2e2;
            --light: #1e1e2d;
            --gray: #a0aec0;
            --card-bg: #2d3748;
            --body-bg: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --sidebar-bg: #1a202c;
            --text-color: #e2e8f0;
            --border-color: #4a5568;
        }

        body {
            background: var(--body-bg);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
        }

        .money-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f4f8;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--secondary);
        }

        .pay-section {
            background: linear-gradient(to right, #4cc9f0, #4895ef);
        }

        .pay-section h2 {
            color: white;
        }

        .pay-section h2 i {
            color: white;
        }

        .payment-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: #444;
        }

        .form-group input, 
        .form-group select {
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .btn-pay {
            background: #ff9e00;
            color: white;
        }

        .btn-pay:hover {
            background: #ff8c00;
            transform: scale(1.02);
        }

        .btn-insight {
            background: var(--primary);
            color: white;
        }

        .btn-insight:hover {
            background: var(--secondary);
            transform: scale(1.02);
        }

        .btn-balance {
            background: var(--success);
            color: white;
        }

        .btn-balance:hover {
            background: #3ab0d6;
            transform: scale(1.02);
        }

        .btn-split {
            background: var(--warning);
            color: white;
        }

        .btn-split:hover {
            background: #e5841c;
            transform: scale(1.02);
        }

        .expense-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .expense-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary);
        }

        .dark-mode .expense-item {
            background: #2d3748;
        }

        .expense-item.shopping {
            border-left-color: #f8961e;
        }

        .expense-item.merchant {
            border-left-color: #4cc9f0;
        }

        .expense-item.other {
            border-left-color: var(--gray);
        }

        .expense-details {
            flex: 1;
        }

        .expense-amount {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--danger);
        }

        .expense-category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .category-shopping {
            background: #fff8e6;
            color: #f8961e;
        }

        .category-merchant {
            background: #e6f7ff;
            color: #4cc9f0;
        }

        .category-other {
            background: #f0f0f0;
            color: var(--gray);
        }

        .insights {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .insight-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .dark-mode .insight-card {
            background: #2d3748;
        }

        .insight-card h3 {
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .expense-segregation {
            margin-top: 20px;
        }

        .segregation-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .segregation-item {
            border-bottom: 1px solid #4a5568;
        }

        .segregation-bar {
            height: 10px;
            background: var(--primary);
            border-radius: 5px;
            margin-top: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(120%);
            transition: transform 0.4s ease;
            z-index: 1000;
            max-width: 350px;
            border-left: 5px solid var(--success);
        }

        .dark-mode .notification {
            background: #2d3748;
            color: white;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification h3 {
            color: var(--success);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .stats-section {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-weight: 600;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            margin-top: 30px;
        }

        /* Detailed Insights Page Styles */
        .insights-page {
            display: none;
        }

        .profile-page {
            display: none;
        }

        .friends-page {
            display: none;
        }

        .insights-header, .profile-header, .friends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .back-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .chart {
            height: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            padding: 20px;
            border-bottom: 2px solid #eee;
        }

        .dark-mode .chart {
            border-bottom: 2px solid #4a5568;
        }

        .bar {
            width: 60px;
            background: var(--primary);
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: height 0.5s ease;
        }

        .bar.shopping { background: #f8961e; }
        .bar.merchant { background: #4cc9f0; }
        .bar.other { background: var(--gray); }

        .bar-label {
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.9rem;
        }

        .bar-value {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-weight: 600;
        }

        .monthly-breakdown, .profile-content, .friends-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .breakdown-card, .profile-card, .friend-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        }

        .breakdown-card h3, .profile-card h3, .friend-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .breakdown-card h3, .dark-mode .profile-card h3, .dark-mode .friend-card h3 {
            border-bottom: 1px solid #4a5568;
        }

        .breakdown-item, .profile-item, .friend-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .dark-mode .breakdown-item, .dark-mode .profile-item, .dark-mode .friend-item {
            border-bottom: 1px solid #4a5568;
        }

        .breakdown-amount, .profile-value, .friend-value {
            font-weight: 600;
        }

        .insights-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .summary-label {
            color: var(--gray);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group-modal {
            margin-bottom: 20px;
        }

        .form-group-modal label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group-modal input, .form-group-modal select, .form-group-modal textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        /* Menu Bar */
        .menu-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .menu-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .menu-dropdown {
            position: absolute;
            top: 60px;
            right: 0;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 200px;
            padding: 10px 0;
            display: none;
            z-index: 1000;
        }

        .menu-dropdown.show {
            display: block;
        }

        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .menu-item:hover {
            background: #f0f4f8;
        }

        .dark-mode .menu-item:hover {
            background: #4a5568;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .user-info {
            border-bottom: 1px solid #4a5568;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.8rem;
            margin-right: 20px;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .user-id {
            color: var(--gray);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .payment-id {
            background: #f0f4f8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .payment-id {
            background: #4a5568;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .balance-display {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            margin: 20px 0;
        }

        /* Edit Profile Button */
        .edit-profile-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 20px;
            width: 100%;
        }

        .edit-profile-btn:hover {
            background: #e5841c;
        }

        /* Call Button */
        .call-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: auto;
        }

        .call-btn:hover {
            background: #2dce89;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .chart {
                flex-direction: column;
                align-items: center;
                height: auto;
                gap: 20px;
            }
            
            .bar {
                width: 100%;
                max-width: 300px;
                height: 40px !important;
                border-radius: 5px;
                display: flex;
                align-items: center;
                justify-content: flex-end;
                padding-right: 10px;
            }
            
            .bar-label {
                position: static;
                margin-left: 10px;
                text-align: left;
            }
            
            .bar-value {
                position: static;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Bar -->
    <div class="menu-bar">
        <button class="menu-btn" id="menuBtn">
            <i class="fas fa-bars"></i>
        </button>
        <div class="menu-dropdown" id="menuDropdown">
            <div class="menu-item" id="splitExpenseBtn">
                <i class="fas fa-exchange-alt"></i> Split Expense
            </div>
            <div class="menu-item" id="profileBtn">
                <i class="fas fa-user"></i> My Profile
            </div>
            <div class="menu-item" id="friendsBtn">
                <i class="fas fa-user-friends"></i> Friends
            </div>
            <div class="menu-item" id="darkModeToggle">
                <i class="fas fa-moon"></i> Dark Mode
            </div>
            <div class="menu-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login to Finity</h2>
                <button class="modal-close" id="closeLogin">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group-modal">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter your username" required>
                </div>
                <div class="form-group-modal">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-insight" id="switchToRegister">Register</button>
                    <button type="submit" class="btn btn-pay">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Account</h2>
                <button class="modal-close" id="closeRegister">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group-modal">
                    <label for="registerUsername">Username</label>
                    <input type="text" id="registerUsername" placeholder="Choose a username" required>
                </div>
                <div class="form-group-modal">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Create a password" required>
                </div>
                <div class="form-group-modal">
                    <label for="registerEmail">Email (Optional)</label>
                    <input type="email" id="registerEmail" placeholder="Enter your email">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-insight" id="switchToLogin">Login</button>
                    <button type="submit" class="btn btn-pay">Register</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Split Expense Modal -->
    <div class="modal" id="splitExpenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Split Expense</h2>
                <button class="modal-close" id="closeSplitExpense">&times;</button>
            </div>
            <form id="splitExpenseForm">
                <div class="form-group-modal">
                    <label for="splitAmount">Amount (₹)</label>
                    <input type="number" id="splitAmount" placeholder="Enter amount to split" min="0.01" step="0.01" required>
                </div>
                <div class="form-group-modal">
                    <label for="splitDescription">Description</label>
                    <input type="text" id="splitDescription" placeholder="What is this for?" required>
                </div>
                <div class="form-group-modal">
                    <label for="splitUserId">User ID to Split With</label>
                    <input type="text" id="splitUserId" placeholder="Enter user ID" required>
                </div>
                <div class="form-group-modal">
                    <label for="splitCategory">Category</label>
                    <select id="splitCategory" required>
                        <option value="">Select category</option>
                        <option value="shopping">Online Shopping</option>
                        <option value="merchant">Merchant Payment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-split">Split Expense</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Profile</h2>
                <button class="modal-close" id="closeEditProfile">&times;</button>
            </div>
            <form id="editProfileForm">
                <div class="form-group-modal">
                    <label for="editPhoneNumber">Phone Number</label>
                    <input type="tel" id="editPhoneNumber" placeholder="Enter phone number">
                </div>
                <div class="form-group-modal">
                    <label for="editGender">Gender</label>
                    <select id="editGender">
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group-modal">
                    <label for="editEmail">Email</label>
                    <input type="email" id="editEmail" placeholder="Enter email">
                </div>
                <div class="form-group-modal">
                    <label for="profilePhoto">Profile Photo</label>
                    <input type="file" id="profilePhoto" accept="image/*">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-insight" id="changePasswordBtn">Change Password</button>
                    <button type="submit" class="btn btn-pay">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Change Password</h2>
                <button class="modal-close" id="closeChangePassword">&times;</button>
            </div>
            <form id="changePasswordForm">
                <div class="form-group-modal">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" required>
                </div>
                <div class="form-group-modal">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" required>
                </div>
                <div class="form-group-modal">
                    <label for="confirmPassword">Confirm New Password</label>
                    <input type="password" id="confirmPassword" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-pay">Update Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Send Payment Modal -->
    <div class="modal" id="sendPaymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Send Payment</h2>
                <button class="modal-close" id="closeSendPayment">&times;</button>
            </div>
            <form id="sendPaymentForm">
                <div class="form-group-modal">
                    <label for="sendAmount">Amount (₹)</label>
                    <input type="number" id="sendAmount" placeholder="Enter amount" min="0.01" step="0.01" required>
                </div>
                <div class="form-group-modal">
                    <label for="sendDescription">Description</label>
                    <input type="text" id="sendDescription" placeholder="What is this for?" required>
                </div>
                <div class="form-group-modal">
                    <label for="sendUserId">Recipient User ID</label>
                    <input type="text" id="sendUserId" placeholder="Enter recipient's user ID" required>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-pay">Send Payment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Dashboard Page -->
    <div class="container" id="dashboard">
        <header>
            <div class="logo">
                <i class="fas fa-indian-rupee-sign"></i>
                <h1>Finity</h1>
            </div>
            <div class="money-display">
                <i class="fas fa-wallet"></i>
                <span id="balanceDisplay">₹0.00</span>
            </div>
        </header>

        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-value" id="totalBalance">₹0.00</div>
                <div class="stat-label">Total Balance</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="monthlyExpenses">₹0.00</div>
                <div class="stat-label">Monthly Expenses</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="dailyAverage">₹0.00</div>
                <div class="stat-label">Daily Average</div>
            </div>
        </div>

        <div class="main-content">
            <div class="card pay-section">
                <h2><i class="fas fa-credit-card"></i> Add Payment</h2>
                <form class="payment-form" id="paymentForm">
                    <div class="form-group">
                        <label for="amount">Amount (₹)</label>
                        <input type="number" id="amount" placeholder="Enter amount" min="0.01" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description (Optional)</label>
                        <input type="text" id="description" placeholder="What was this for?">
                    </div>
                    <div class="form-group">
                        <label for="recipientId">Pay to User ID (Optional)</label>
                        <input type="text" id="recipientId" placeholder="Enter recipient's User ID">
                    </div>
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" required>
                            <option value="">Select category</option>
                            <option value="shopping">Online Shopping</option>
                            <option value="merchant">Merchant Payment</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-pay">
                        <i class="fas fa-money-bill-wave"></i> Pay Now
                    </button>
                </form>
            </div>

            <div class="card">
                <h2><i class="fas fa-chart-line"></i> Expense Insights</h2>
                <div class="insights">
                    <div class="insight-card">
                        <h3>Daily Expenditure</h3>
                        <div class="insight-value" id="dailyExpenditure">₹0.00</div>
                    </div>
                    <div class="insight-card">
                        <h3>Monthly Expenditure</h3>
                        <div class="insight-value" id="monthlyExpenditure">₹0.00</div>
                    </div>
                </div>
                
                <div class="expense-segregation">
                    <h3 style="margin: 20px 0 15px; color: var(--dark);">Expense Segregation</h3>
                    <div class="segregation-item">
                        <span>Online Shopping</span>
                        <span id="shoppingAmount">₹0.00</span>
                    </div>
                    <div class="segregation-bar" style="width: 70%; background: #f8961e;"></div>
                    
                    <div class="segregation-item">
                        <span>Merchant Payments</span>
                        <span id="merchantAmount">₹0.00</span>
                    </div>
                    <div class="segregation-bar" style="width: 45%; background: #4cc9f0;"></div>
                    
                    <div class="segregation-item">
                        <span>Other Expenses</span>
                        <span id="otherAmount">₹0.00</span>
                    </div>
                    <div class="segregation-bar" style="width: 15%; background: var(--gray);"></div>
                </div>
                
                <button class="btn btn-insight" id="viewInsightsBtn" style="margin-top: 25px; width: 100%;">
                    <i class="fas fa-chart-pie"></i> View Detailed Insights
                </button>
                
                <button class="btn btn-balance" id="checkBalanceBtn" style="margin-top: 15px; width: 100%;">
                    <i class="fas fa-coins"></i> Check Balance
                </button>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-receipt"></i> Recent Transactions</h2>
            <div class="expense-list" id="expenseList">
                <!-- Transactions will be added here dynamically -->
            </div>
        </div>
    </div>

    <!-- Detailed Insights Page -->
    <div class="container insights-page" id="insightsPage">
        <div class="insights-header">
            <h1><i class="fas fa-chart-pie"></i> Detailed Insights</h1>
            <button class="back-btn" id="backToDashboard">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">Monthly Expense Distribution</h2>
            <div class="chart">
                <div class="bar shopping" style="height: 220px;">
                    <div class="bar-value" id="shoppingValue">₹0.00</div>
                    <div class="bar-label">Shopping</div>
                </div>
                <div class="bar merchant" style="height: 150px;">
                    <div class="bar-value" id="merchantValue">₹0.00</div>
                    <div class="bar-label">Merchant</div>
                </div>
                <div class="bar other" style="height: 50px;">
                    <div class="bar-value" id="otherValue">₹0.00</div>
                    <div class="bar-label">Other</div>
                </div>
            </div>
        </div>

        <div class="monthly-breakdown">
            <div class="breakdown-card">
                <h3><i class="fas fa-shopping-cart"></i> Online Shopping</h3>
                <div class="breakdown-item">
                    <span>Amazon</span>
                    <div class="breakdown-amount" id="amazonAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Flipkart</span>
                    <div class="breakdown-amount" id="flipkartAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Etsy</span>
                    <div class="breakdown-amount" id="etsyAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Other</span>
                    <div class="breakdown-amount" id="otherShoppingAmount">₹0.00</div>
                </div>
            </div>
            
            <div class="breakdown-card">
                <h3><i class="fas fa-store"></i> Merchant Payments</h3>
                <div class="breakdown-item">
                    <span>Starbucks</span>
                    <div class="breakdown-amount" id="starbucksAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Uber</span>
                    <div class="breakdown-amount" id="uberAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Swiggy</span>
                    <div class="breakdown-amount" id="swiggyAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Other</span>
                    <div class="breakdown-amount" id="otherMerchantAmount">₹0.00</div>
                </div>
            </div>
            
            <div class="breakdown-card">
                <h3><i class="fas fa-file-invoice"></i> Other Expenses</h3>
                <div class="breakdown-item">
                    <span>Gym</span>
                    <div class="breakdown-amount" id="gymAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Netflix</span>
                    <div class="breakdown-amount" id="netflixAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Electricity</span>
                    <div class="breakdown-amount" id="electricityAmount">₹0.00</div>
                </div>
                <div class="breakdown-item">
                    <span>Other</span>
                    <div class="breakdown-amount" id="otherExpensesAmount">₹0.00</div>
                </div>
            </div>
        </div>

        <div class="insights-summary">
            <div class="summary-card">
                <i class="fas fa-calendar-alt fa-2x" style="color: var(--primary);"></i>
                <div class="summary-value" id="totalMonthlyExpenses">₹0.00</div>
                <div class="summary-label">Total Monthly Expenses</div>
            </div>
            
            <div class="summary-card">
                <i class="fas fa-chart-line fa-2x" style="color: var(--success);"></i>
                <div class="summary-value" id="dailyAvg">₹0.00</div>
                <div class="summary-label">Daily Average</div>
            </div>
            
            <div class="summary-card">
                <i class="fas fa-percentage fa-2x" style="color: var(--warning);"></i>
                <div class="summary-value" id="shoppingShare">0%</div>
                <div class="summary-label">Shopping Share</div>
            </div>
            
            <div class="summary-card">
                <i class="fas fa-trending-up fa-2x" style="color: var(--danger);"></i>
                <div class="summary-value" id="vsPrevious">0%</div>
                <div class="summary-label">vs Previous Month</div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="container profile-page" id="profilePage">
        <div class="profile-header">
            <h1><i class="fas fa-user"></i> My Profile</h1>
            <button class="back-btn" id="backToDashboardFromProfile">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
        </div>

        <div class="profile-content">
            <div class="profile-card">
                <div class="user-info">
                    <div class="user-avatar" id="profileAvatar">
                        <!-- Avatar will be displayed here -->
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="profileName">User Name</div>
                        <div class="user-id" id="profileUserId">User ID</div>
                        <div class="payment-id">
                            <span>Your Payment ID: <strong id="profilePaymentId">USER000000</strong></span>
                            <button class="copy-btn" id="copyPaymentId">Copy</button>
                        </div>
                    </div>
                </div>
                
                <div class="profile-item">
                    <span>Email:</span>
                    <span class="profile-value" id="profileEmail">-</span>
                </div>
                <div class="profile-item">
                    <span>Phone:</span>
                    <span class="profile-value" id="profilePhone">-</span>
                </div>
                <div class="profile-item">
                    <span>Gender:</span>
                    <span class="profile-value" id="profileGender">-</span>
                </div>
                <div class="profile-item">
                    <span>Balance:</span>
                    <span class="profile-value" id="profileBalance">₹0.00</span>
                </div>
                
                <button class="edit-profile-btn" id="editProfileBtn">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>
        </div>
    </div>

    <!-- Friends Page -->
    <div class="container friends-page" id="friendsPage">
        <div class="friends-header">
            <h1><i class="fas fa-user-friends"></i> Friends</h1>
            <button class="back-btn" id="backToDashboardFromFriends">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </button>
        </div>

        <div class="friends-content" id="friendsList">
            <!-- Friends will be added here dynamically -->
        </div>
    </div>

    <div class="notification" id="notification">
        <button class="close-btn">&times;</button>
        <h3><i class="fas fa-check-circle"></i> Success!</h3>
        <p id="notificationText">Action completed successfully</p>
    </div>

    <footer>
        <p>Finity &copy; 2025 - Your Personal Expense Tracker</p>
    </footer>

    <script>
        // User data storage
        let users = JSON.parse(localStorage.getItem('finityUsers')) || [];
        let currentUser = null;
        
        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const splitExpenseModal = document.getElementById('splitExpenseModal');
        const editProfileModal = document.getElementById('editProfileModal');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const sendPaymentModal = document.getElementById('sendPaymentModal');
        const dashboard = document.getElementById('dashboard');
        const insightsPage = document.getElementById('insightsPage');
        const profilePage = document.getElementById('profilePage');
        const friendsPage = document.getElementById('friendsPage');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const closeBtn = document.querySelector('.close-btn');
        const viewInsightsBtn = document.getElementById('viewInsightsBtn');
        const backToDashboard = document.getElementById('backToDashboard');
        const backToDashboardFromProfile = document.getElementById('backToDashboardFromProfile');
        const backToDashboardFromFriends = document.getElementById('backToDashboardFromFriends');
        const menuBtn = document.getElementById('menuBtn');
        const menuDropdown = document.getElementById('menuDropdown');
        const splitExpenseBtn = document.getElementById('splitExpenseBtn');
        const profileBtn = document.getElementById('profileBtn');
        const friendsBtn = document.getElementById('friendsBtn');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const logoutBtn = document.getElementById('logoutBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const copyPaymentId = document.getElementById('copyPaymentId');
        
        // Form elements
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const splitExpenseForm = document.getElementById('splitExpenseForm');
        const editProfileForm = document.getElementById('editProfileForm');
        const changePasswordForm = document.getElementById('changePasswordForm');
        const sendPaymentForm = document.getElementById('sendPaymentForm');
        const paymentForm = document.getElementById('paymentForm');
        const checkBalanceBtn = document.getElementById('checkBalanceBtn');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            const storedUser = localStorage.getItem('finityCurrentUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                showDashboard();
            } else {
                showLoginModal();
            }
            
            // Event listeners
            document.getElementById('closeLogin').addEventListener('click', hideLoginModal);
            document.getElementById('closeRegister').addEventListener('click', hideRegisterModal);
            document.getElementById('closeSplitExpense').addEventListener('click', hideSplitExpenseModal);
            document.getElementById('closeEditProfile').addEventListener('click', hideEditProfileModal);
            document.getElementById('closeChangePassword').addEventListener('click', hideChangePasswordModal);
            document.getElementById('closeSendPayment').addEventListener('click', hideSendPaymentModal);
            document.getElementById('switchToRegister').addEventListener('click', () => {
                hideLoginModal();
                showRegisterModal();
            });
            document.getElementById('switchToLogin').addEventListener('click', () => {
                hideRegisterModal();
                showLoginModal();
            });
            
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            splitExpenseForm.addEventListener('submit', handleSplitExpense);
            editProfileForm.addEventListener('submit', handleEditProfile);
            changePasswordForm.addEventListener('submit', handleChangePassword);
            sendPaymentForm.addEventListener('submit', handleSendPayment);
            paymentForm.addEventListener('submit', handlePayment);
            checkBalanceBtn.addEventListener('click', showBalance);
            editProfileBtn.addEventListener('click', showEditProfileModal);
            changePasswordBtn.addEventListener('click', showChangePasswordModal);
            copyPaymentId.addEventListener('click', copyToClipboard);
            
            menuBtn.addEventListener('click', toggleMenu);
            splitExpenseBtn.addEventListener('click', showSplitExpenseModal);
            profileBtn.addEventListener('click', showProfile);
            friendsBtn.addEventListener('click', showFriends);
            darkModeToggle.addEventListener('click', toggleDarkMode);
            logoutBtn.addEventListener('click', handleLogout);
            
            viewInsightsBtn.addEventListener('click', showInsights);
            backToDashboard.addEventListener('click', showDashboard);
            backToDashboardFromProfile.addEventListener('click', showDashboard);
            backToDashboardFromFriends.addEventListener('click', showDashboard);
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!menuBtn.contains(e.target) && !menuDropdown.contains(e.target)) {
                    menuDropdown.classList.remove('show');
                }
            });
            
            // Close notification when close button is clicked
            closeBtn.addEventListener('click', function() {
                notification.classList.remove('show');
            });
        });
        
        // Show login modal
        function showLoginModal() {
            loginModal.style.display = 'flex';
        }
        
        // Hide login modal
        function hideLoginModal() {
            loginModal.style.display = 'none';
        }
        
        // Show register modal
        function showRegisterModal() {
            registerModal.style.display = 'flex';
        }
        
        // Hide register modal
        function hideRegisterModal() {
            registerModal.style.display = 'none';
        }
        
        // Show split expense modal
        function showSplitExpenseModal() {
            splitExpenseModal.style.display = 'flex';
            menuDropdown.classList.remove('show');
        }
        
        // Hide split expense modal
        function hideSplitExpenseModal() {
            splitExpenseModal.style.display = 'none';
        }
        
        // Show edit profile modal
        function showEditProfileModal() {
            if (!currentUser) return;
            
            // Populate form with current data
            document.getElementById('editPhoneNumber').value = currentUser.phone || '';
            document.getElementById('editGender').value = currentUser.gender || '';
            document.getElementById('editEmail').value = currentUser.email || '';
            
            editProfileModal.style.display = 'flex';
        }
        
        // Hide edit profile modal
        function hideEditProfileModal() {
            editProfileModal.style.display = 'none';
        }
        
        // Show change password modal
        function showChangePasswordModal() {
            changePasswordModal.style.display = 'flex';
        }
        
        // Hide change password modal
        function hideChangePasswordModal() {
            changePasswordModal.style.display = 'none';
        }
        
        // Show send payment modal
        function showSendPaymentModal() {
            sendPaymentModal.style.display = 'flex';
        }
        
        // Hide send payment modal
        function hideSendPaymentModal() {
            sendPaymentModal.style.display = 'none';
        }
        
        // Toggle menu dropdown
        function toggleMenu() {
            menuDropdown.classList.toggle('show');
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            menuDropdown.classList.remove('show');
        }
        
        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('finityCurrentUser', JSON.stringify(user));
                hideLoginModal();
                showDashboard();
                showNotification(`Welcome back, ${user.username}!`);
            } else {
                showNotification('Invalid username or password', 'error');
            }
        }
        
        // Handle registration
        function handleRegister(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const email = document.getElementById('registerEmail').value;
            
            // Check if username already exists
            if (users.some(u => u.username === username)) {
                showNotification('Username already exists', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: generateUserId(),
                username,
                password,
                email,
                phone: '',
                gender: '',
                profilePhoto: '',
                balance: 100000, // Starting balance
                expenses: [],
                transactions: [],
                friends: []
            };
            
            users.push(newUser);
            localStorage.setItem('finityUsers', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('finityCurrentUser', JSON.stringify(newUser));
            
            hideRegisterModal();
            showDashboard();
            showNotification(`Account created successfully! Your user ID is ${newUser.id}`);
        }
        
        // Handle payment
        function handlePayment(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('amount').value);
            const description = document.getElementById('description').value || 'No description';
            const recipientId = document.getElementById('recipientId').value.trim();
            const category = document.getElementById('category').value;
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            if (recipientId) {
                // Pay to another user
                const recipient = users.find(u => u.id === recipientId);
                if (!recipient) {
                    showNotification('Recipient User ID not found', 'error');
                    return;
                }
                
                if (currentUser.balance < amount) {
                    showNotification('Insufficient balance', 'error');
                    return;
                }
                
                // Transfer money
                currentUser.balance -= amount;
                recipient.balance += amount;
                
                // Create transactions
                const senderTxn = {
                    id: generateTransactionId(),
                    amount,
                    description,
                    category,
                    date: new Date().toISOString(),
                    type: 'payment_to_user',
                    to: recipientId
                };
                
                const recipientTxn = {
                    id: generateTransactionId(),
                    amount,
                    description,
                    category,
                    date: new Date().toISOString(),
                    type: 'payment_from_user',
                    from: currentUser.id
                };
                
                currentUser.transactions.push(senderTxn);
                if (!recipient.transactions) recipient.transactions = [];
                recipient.transactions.push(recipientTxn);
                
                // Update storage
                updateUserData();
                showNotification(`Payment of ₹${amount} sent to ${recipientId} successfully!`);
                addExpenseToList(amount, description, category, recipientId);
            } else {
                // Regular expense
                if (currentUser.balance < amount) {
                    showNotification('Insufficient balance', 'error');
                    return;
                }
                
                currentUser.balance -= amount;
                const transaction = {
                    id: generateTransactionId(),
                    amount,
                    description,
                    category,
                    date: new Date().toISOString(),
                    type: 'expense'
                };
                currentUser.transactions.push(transaction);
                currentUser.expenses.push(transaction);
                updateUserData();
                showNotification(`Payment of ₹${amount} added successfully!`);
                addExpenseToList(amount, description, category);
            }
            
            // Reset form
            paymentForm.reset();
        }
        
        // Handle split expense
        function handleSplitExpense(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('splitAmount').value);
            const description = document.getElementById('splitDescription').value;
            const userId = document.getElementById('splitUserId').value;
            const category = document.getElementById('splitCategory').value;
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            // Find the user to split with
            const targetUser = users.find(u => u.id === userId);
            if (!targetUser) {
                showNotification('User not found', 'error');
                return;
            }
            
            if (currentUser.balance < amount) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            // Calculate split amount (50-50)
            const splitAmount = amount / 2;
            
            // Update balances
            currentUser.balance -= splitAmount;
            targetUser.balance -= splitAmount;
            
            // Create transactions for both users
            const transaction1 = {
                id: generateTransactionId(),
                amount: splitAmount,
                description: `Split: ${description}`,
                category,
                date: new Date().toISOString(),
                type: 'expense',
                from: currentUser.id,
                to: targetUser.id
            };
            
            const transaction2 = {
                id: generateTransactionId(),
                amount: splitAmount,
                description: `Split: ${description}`,
                category,
                date: new Date().toISOString(),
                type: 'expense',
                from: targetUser.id,
                to: currentUser.id
            };
            
            currentUser.transactions.push(transaction1);
            currentUser.expenses.push(transaction1);
            
            if (!targetUser.transactions) targetUser.transactions = [];
            if (!targetUser.expenses) targetUser.expenses = [];
            targetUser.transactions.push(transaction2);
            targetUser.expenses.push(transaction2);
            
            // Update local storage
            updateUserData();
            
            // Show notification
            showNotification(`Expense of ₹${amount} split with user ${userId}. You paid ₹${splitAmount.toFixed(2)}`);
            
            // Add to expense list
            addExpenseToList(splitAmount, `Split: ${description}`, category);
            
            // Reset form
            splitExpenseForm.reset();
            hideSplitExpenseModal();
        }
        
        // Handle send payment (separate modal)
        function handleSendPayment(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('sendAmount').value);
            const description = document.getElementById('sendDescription').value;
            const userId = document.getElementById('sendUserId').value;
            
            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount', 'error');
                return;
            }
            
            const recipient = users.find(u => u.id === userId);
            if (!recipient) {
                showNotification('Recipient User ID not found', 'error');
                return;
            }
            
            if (currentUser.balance < amount) {
                showNotification('Insufficient balance', 'error');
                return;
            }
            
            // Transfer money
            currentUser.balance -= amount;
            recipient.balance += amount;
            
            // Create transactions
            const senderTxn = {
                id: generateTransactionId(),
                amount,
                description,
                category: 'payment',
                date: new Date().toISOString(),
                type: 'payment_to_user',
                to: userId
            };
            
            const recipientTxn = {
                id: generateTransactionId(),
                amount,
                description,
                category: 'payment',
                date: new Date().toISOString(),
                type: 'payment_from_user',
                from: currentUser.id
            };
            
            currentUser.transactions.push(senderTxn);
            if (!recipient.transactions) recipient.transactions = [];
            recipient.transactions.push(recipientTxn);
            
            // Update storage
            updateUserData();
            showNotification(`Payment of ₹${amount} sent to ${userId} successfully!`);
            
            // Reset form
            sendPaymentForm.reset();
            hideSendPaymentModal();
        }
        
        // Handle edit profile
        function handleEditProfile(e) {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const phone = document.getElementById('editPhoneNumber').value;
            const gender = document.getElementById('editGender').value;
            const email = document.getElementById('editEmail').value;
            const fileInput = document.getElementById('profilePhoto');
            
            // Handle profile photo
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.profilePhoto = e.target.result;
                    saveProfileChanges(phone, gender, email);
                };
                reader.readAsDataURL(file);
            } else {
                saveProfileChanges(phone, gender, email);
            }
        }
        
        function saveProfileChanges(phone, gender, email) {
            currentUser.phone = phone;
            currentUser.gender = gender;
            currentUser.email = email;
            
            // Update storage
            updateUserData();
            showNotification('Profile updated successfully!');
            hideEditProfileModal();
            updateProfilePage();
        }
        
        // Handle change password
        function handleChangePassword(e) {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (currentUser.password !== currentPassword) {
                showNotification('Current password is incorrect', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('New passwords do not match', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPassword;
            updateUserData();
            showNotification('Password updated successfully!');
            hideChangePasswordModal();
        }
        
        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('finityCurrentUser');
            showLoginModal();
            showNotification('Logged out successfully');
        }
        
        // Show balance
        function showBalance() {
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            showNotification(`Your balance is ₹${currentUser.balance.toFixed(2)}`);
        }
        
        // Show profile
        function showProfile() {
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            dashboard.style.display = 'none';
            insightsPage.style.display = 'none';
            friendsPage.style.display = 'none';
            profilePage.style.display = 'block';
            updateProfilePage();
            menuDropdown.classList.remove('show');
        }
        
        // Update profile page
        function updateProfilePage() {
            if (!currentUser) return;
            
            document.getElementById('profileName').textContent = currentUser.username;
            document.getElementById('profileUserId').textContent = `User ID: ${currentUser.id}`;
            document.getElementById('profilePaymentId').textContent = currentUser.id;
            document.getElementById('profileEmail').textContent = currentUser.email || '-';
            document.getElementById('profilePhone').textContent = currentUser.phone || '-';
            document.getElementById('profileGender').textContent = currentUser.gender || '-';
            document.getElementById('profileBalance').textContent = `₹${currentUser.balance.toFixed(2)}`;
            
            // Update avatar
            const avatar = document.getElementById('profileAvatar');
            if (currentUser.profilePhoto) {
                avatar.innerHTML = `<img src="${currentUser.profilePhoto}" alt="Profile">`;
            } else {
                const initials = currentUser.username.charAt(0).toUpperCase();
                avatar.innerHTML = initials;
            }
        }
        
        // Show friends
        function showFriends() {
            if (!currentUser) {
                showNotification('Please login first', 'error');
                return;
            }
            
            dashboard.style.display = 'none';
            insightsPage.style.display = 'none';
            profilePage.style.display = 'none';
            friendsPage.style.display = 'block';
            updateFriendsPage();
            menuDropdown.classList.remove('show');
        }
        
        // Update friends page
        function updateFriendsPage() {
            if (!currentUser) return;
            
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            // For demo, show all users as friends (in real app, you'd have a friends list)
            users.forEach(user => {
                if (user.id !== currentUser.id) {
                    const friendCard = document.createElement('div');
                    friendCard.classList.add('friend-card');
                    friendCard.innerHTML = `
                        <h3>${user.username}</h3>
                        <div class="friend-item">
                            <span>User ID:</span>
                            <span class="friend-value">${user.id}</span>
                        </div>
                        <div class="friend-item">
                            <span>Balance:</span>
                            <span class="friend-value">₹${user.balance.toFixed(2)}</span>
                        </div>
                        <div class="friend-item">
                            <span>Status:</span>
                            <span class="friend-value">Online</span>
                            <button class="call-btn" onclick="initiateCall('${user.id}')">
                                <i class="fas fa-phone"></i> Call
                            </button>
                        </div>
                    `;
                    friendsList.appendChild(friendCard);
                }
            });
        }
        
        // Initiate call (demo)
        function initiateCall(userId) {
            showNotification(`Calling user ${userId}... (This is a demo feature)`);
        }
        
        // Show dashboard
        function showDashboard() {
            dashboard.style.display = 'block';
            insightsPage.style.display = 'none';
            profilePage.style.display = 'none';
            friendsPage.style.display = 'none';
            updateDashboard();
        }
        
        // Show insights
        function showInsights() {
            dashboard.style.display = 'none';
            insightsPage.style.display = 'block';
            profilePage.style.display = 'none';
            friendsPage.style.display = 'none';
            updateInsights();
        }
        
        // Update dashboard with user data
        function updateDashboard() {
            if (!currentUser) return;
            
            document.getElementById('balanceDisplay').textContent = `₹${currentUser.balance.toFixed(2)}`;
            document.getElementById('totalBalance').textContent = `₹${currentUser.balance.toFixed(2)}`;
            
            // Calculate monthly expenses
            const monthlyExpenses = currentUser.expenses
                .filter(expense => {
                    const expenseDate = new Date(expense.date);
                    const now = new Date();
                    return expenseDate.getMonth() === now.getMonth() && 
                           expenseDate.getFullYear() === now.getFullYear();
                })
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            document.getElementById('monthlyExpenses').textContent = `₹${monthlyExpenses.toFixed(2)}`;
            document.getElementById('monthlyExpenditure').textContent = `₹${monthlyExpenses.toFixed(2)}`;
            
            // Calculate daily average
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const dailyAverage = monthlyExpenses / daysInMonth;
            document.getElementById('dailyAverage').textContent = `₹${dailyAverage.toFixed(2)}`;
            document.getElementById('dailyExpenditure').textContent = `₹${dailyAverage.toFixed(2)}`;
            
            // Calculate expense segregation
            const shoppingExpenses = currentUser.expenses
                .filter(expense => expense.category === 'shopping')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const merchantExpenses = currentUser.expenses
                .filter(expense => expense.category === 'merchant')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const otherExpenses = currentUser.expenses
                .filter(expense => expense.category === 'other')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            document.getElementById('shoppingAmount').textContent = `₹${shoppingExpenses.toFixed(2)}`;
            document.getElementById('merchantAmount').textContent = `₹${merchantExpenses.toFixed(2)}`;
            document.getElementById('otherAmount').textContent = `₹${otherExpenses.toFixed(2)}`;
            
            // Update expense list
            updateExpenseList();
        }
        
        // Update insights page with user data
        function updateInsights() {
            if (!currentUser) return;
            
            // Calculate monthly expenses
            const monthlyExpenses = currentUser.expenses
                .filter(expense => {
                    const expenseDate = new Date(expense.date);
                    const now = new Date();
                    return expenseDate.getMonth() === now.getMonth() && 
                           expenseDate.getFullYear() === now.getFullYear();
                })
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            // Calculate expense segregation
            const shoppingExpenses = currentUser.expenses
                .filter(expense => expense.category === 'shopping')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const merchantExpenses = currentUser.expenses
                .filter(expense => expense.category === 'merchant')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const otherExpenses = currentUser.expenses
                .filter(expense => expense.category === 'other')
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            // Update chart values
            document.getElementById('shoppingValue').textContent = `₹${shoppingExpenses.toFixed(2)}`;
            document.getElementById('merchantValue').textContent = `₹${merchantExpenses.toFixed(2)}`;
            document.getElementById('otherValue').textContent = `₹${otherExpenses.toFixed(2)}`;
            
            // Update breakdown values (simplified for demo)
            document.getElementById('amazonAmount').textContent = `₹${(shoppingExpenses * 0.4).toFixed(2)}`;
            document.getElementById('flipkartAmount').textContent = `₹${(shoppingExpenses * 0.3).toFixed(2)}`;
            document.getElementById('etsyAmount').textContent = `₹${(shoppingExpenses * 0.2).toFixed(2)}`;
            document.getElementById('otherShoppingAmount').textContent = `₹${(shoppingExpenses * 0.1).toFixed(2)}`;
            
            document.getElementById('starbucksAmount').textContent = `₹${(merchantExpenses * 0.3).toFixed(2)}`;
            document.getElementById('uberAmount').textContent = `₹${(merchantExpenses * 0.25).toFixed(2)}`;
            document.getElementById('swiggyAmount').textContent = `₹${(merchantExpenses * 0.25).toFixed(2)}`;
            document.getElementById('otherMerchantAmount').textContent = `₹${(merchantExpenses * 0.2).toFixed(2)}`;
            
            document.getElementById('gymAmount').textContent = `₹${(otherExpenses * 0.3).toFixed(2)}`;
            document.getElementById('netflixAmount').textContent = `₹${(otherExpenses * 0.25).toFixed(2)}`;
            document.getElementById('electricityAmount').textContent = `₹${(otherExpenses * 0.25).toFixed(2)}`;
            document.getElementById('otherExpensesAmount').textContent = `₹${(otherExpenses * 0.2).toFixed(2)}`;
            
            // Update summary
            document.getElementById('totalMonthlyExpenses').textContent = `₹${monthlyExpenses.toFixed(2)}`;
            
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const dailyAverage = monthlyExpenses / daysInMonth;
            document.getElementById('dailyAvg').textContent = `₹${dailyAverage.toFixed(2)}`;
            
            const shoppingShare = (shoppingExpenses / monthlyExpenses) * 100 || 0;
            document.getElementById('shoppingShare').textContent = `${shoppingShare.toFixed(0)}%`;
            
            // For demo purposes, show a positive trend
            document.getElementById('vsPrevious').textContent = '+12%';
        }
        
        // Update expense list
        function updateExpenseList() {
            const expenseList = document.getElementById('expenseList');
            expenseList.innerHTML = '';
            
            // Get recent expenses (last 5)
            const recentExpenses = [...currentUser.transactions].reverse().slice(0, 5);
            
            recentExpenses.forEach(transaction => {
                const expenseItem = document.createElement('div');
                expenseItem.classList.add('expense-item');
                
                // Determine category and styling
                let category = 'other';
                let description = transaction.description;
                
                if (transaction.type === 'payment_to_user') {
                    category = 'merchant';
                    description = `To ${transaction.to}: ${description}`;
                    expenseItem.classList.add('merchant');
                } else if (transaction.type === 'payment_from_user') {
                    category = 'merchant';
                    description = `From ${transaction.from}: ${description}`;
                    expenseItem.classList.add('merchant');
                } else if (transaction.category === 'shopping') {
                    expenseItem.classList.add('shopping');
                    category = 'shopping';
                } else if (transaction.category === 'merchant') {
                    expenseItem.classList.add('merchant');
                    category = 'merchant';
                } else {
                    expenseItem.classList.add('other');
                    category = 'other';
                }
                
                expenseItem.innerHTML = `
                    <div class="expense-details">
                        <div class="expense-description">${description}</div>
                        <div class="expense-category category-${category}">${getCategoryName(category)}</div>
                    </div>
                    <div class="expense-amount">${transaction.type === 'payment_from_user' ? '+' : '-'}₹${transaction.amount.toFixed(2)}</div>
                `;
                
                expenseList.appendChild(expenseItem);
            });
        }
        
        // Add expense to the list
        function addExpenseToList(amount, description, category, recipientId) {
            const expenseList = document.getElementById('expenseList');
            
            const expenseItem = document.createElement('div');
            expenseItem.classList.add('expense-item');
            
            // Add category-specific class
            if (recipientId) {
                expenseItem.classList.add('merchant');
                description = `To ${recipientId}: ${description}`;
            } else if (category === 'shopping') {
                expenseItem.classList.add('shopping');
            } else if (category === 'merchant') {
                expenseItem.classList.add('merchant');
            } else {
                expenseItem.classList.add('other');
            }
            
            expenseItem.innerHTML = `
                <div class="expense-details">
                    <div class="expense-description">${description}</div>
                    <div class="expense-category category-${category}">${getCategoryName(category)}</div>
                </div>
                <div class="expense-amount">-₹${amount.toFixed(2)}</div>
            `;
            
            // Add to the beginning of the list
            expenseList.insertBefore(expenseItem, expenseList.firstChild);
        }
        
        // Get category name
        function getCategoryName(category) {
            switch(category) {
                case 'shopping': return 'Online Shopping';
                case 'merchant': return 'Merchant Payment';
                case 'other': return 'Other';
                case 'payment': return 'Payment';
                default: return 'Unknown';
            }
        }
        
        // Generate user ID
        function generateUserId() {
            return 'USER' + Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
        }
        
        // Generate transaction ID
        function generateTransactionId() {
            return 'TXN' + Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // Update user data in localStorage
        function updateUserData() {
            // Find and update the current user in the users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('finityUsers', JSON.stringify(users));
            }
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            notificationText.textContent = message;
            
            if (type === 'error') {
                notification.querySelector('h3').innerHTML = '<i class="fas fa-exclamation-circle"></i> Error!';
                notification.style.borderLeftColor = '#f72585';
            } else {
                notification.querySelector('h3').innerHTML = '<i class="fas fa-check-circle"></i> Success!';
                notification.style.borderLeftColor = '#4cc9f0';
            }
            
            notification.classList.add('show');
            
            // Auto-hide notification after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            const text = currentUser.id;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('User ID copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showNotification('Failed to copy User ID', 'error');
            });
        }
    </script>
</body>
</html>
